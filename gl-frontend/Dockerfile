FROM node:22.14.0

ARG NODE_ENV=production
ENV NODE_ENV=${NODE_ENV}
ARG VITE_BASE_URL
ENV VITE_BASE_URL=${VITE_BASE_URL}
ARG VITE_API_URL
ENV VITE_API_URL=${VITE_API_URL}
ARG VITE_GITHUB_LOGIN_URL
ENV VITE_GITHUB_LOGIN_URL=${VITE_GITHUB_LOGIN_URL}
ARG VITE_GITHUB_CLIENT_ID
ENV VITE_GITHUB_CLIENT_ID=${VITE_GITHUB_CLIENT_ID}
ARG VITE_GITHUB_REDIRECT_URL
ENV VITE_GITHUB_REDIRECT_URL=${VITE_GITHUB_REDIRECT_URL}


WORKDIR /app

COPY package.json pnpm-lock.yaml ./

RUN corepack enable && corepack use pnpm

RUN pnpm install --frozen-lockfile

COPY . .

RUN pnpm build

CMD ["pnpm", "preview", "--host"]